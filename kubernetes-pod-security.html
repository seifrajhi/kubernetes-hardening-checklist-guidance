
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Kubernetes Pod Security Â· Kubernetes Hardening Guide (Produced by the National Security Agency)</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-image-captions/image-captions.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-prism/prism-ghcolors.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-lightbox/css/lightbox.min.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-insert-logo/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="network-separation-and-hardening.html" />
    
    
    <link rel="prev" href="threat-model.html" />
    

    
        <link rel="shortcut icon" href='favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='favicon.ico' type="image/x-icon">
    
    
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"repo":"seifrajhi/kubernetes-hardening-checklist-guidance","types":["star"],"size":"small"};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://seifrajhi.github.io/kubernetes-hardening-checklist-guidance" target="_blank" class="custom-link">Return to home page</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        <li class="header">start</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                        <b>1.1.</b>
                    
                    Description
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="notices-and-hitory.html">
            
                <a href="notices-and-hitory.html">
            
                    
                        <b>1.2.</b>
                    
                    Notices and History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="publication-information.html">
            
                <a href="publication-information.html">
            
                    
                        <b>1.3.</b>
                    
                    publication information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="executive-summary.html">
            
                <a href="executive-summary.html">
            
                    
                        <b>1.4.</b>
                    
                    executive summary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="corrigendum.html">
            
                <a href="corrigendum.html">
            
                    
                        <b>1.5.</b>
                    
                    Corrigendum
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Text</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="introduction.html">
            
                <a href="introduction.html">
            
                    
                        <b>2.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="threat-model.html">
            
                <a href="threat-model.html">
            
                    
                        <b>2.2.</b>
                    
                    Threat Modeling
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.3" data-path="kubernetes-pod-security.html">
            
                <a href="kubernetes-pod-security.html">
            
                    
                        <b>2.3.</b>
                    
                    Kubernetes Pod Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="network-separation-and-hardening.html">
            
                <a href="network-separation-and-hardening.html">
            
                    
                        <b>2.4.</b>
                    
                    Network isolation and hardening
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="authentication-and-authorization.html">
            
                <a href="authentication-and-authorization.html">
            
                    
                        <b>2.5.</b>
                    
                    Authentication and Authorization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="logging.html">
            
                <a href="logging.html">
            
                    
                        <b>2.6.</b>
                    
                    Log Audit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="upgrading-and-application-security-practices.html">
            
                <a href="upgrading-and-application-security-practices.html">
            
                    
                        <b>2.7.</b>
                    
                    Upgrading and application security practices
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Appendix</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="appendix/a.html">
            
                <a href="appendix/a.html">
            
                    
                        <b>3.1.</b>
                    
                    Appendix A: Example Dockerfile for non-root applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="appendix/b.html">
            
                <a href="appendix/b.html">
            
                    
                        <b>3.2.</b>
                    
                    Appendix B: Deployment template example for read-only file system
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="appendix/c.html">
            
                <a href="appendix/c.html">
            
                    
                        <b>3.3.</b>
                    
                    Appendix C: Pod Security Policy Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="appendix/d.html">
            
                <a href="appendix/d.html">
            
                    
                        <b>3.4.</b>
                    
                    Appendix D: Namespace Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="appendix/e.html">
            
                <a href="appendix/e.html">
            
                    
                        <b>3.5.</b>
                    
                    Appendix E: Network Policy Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="appendix/f.html">
            
                <a href="appendix/f.html">
            
                    
                        <b>3.6.</b>
                    
                    Appendix F: LimitRange Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="appendix/g.html">
            
                <a href="appendix/g.html">
            
                    
                        <b>3.7.</b>
                    
                    Appendix G: ResourceQuota Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="appendix/h.html">
            
                <a href="appendix/h.html">
            
                    
                        <b>3.8.</b>
                    
                    Appendix H: Encryption Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="appendix/i.html">
            
                <a href="appendix/i.html">
            
                    
                        <b>3.9.</b>
                    
                    Appendix I: KMS configuration example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10" data-path="appendix/j.html">
            
                <a href="appendix/j.html">
            
                    
                        <b>3.10.</b>
                    
                    Appendix J: pod-reader RBAC role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11" data-path="appendix/k.html">
            
                <a href="appendix/k.html">
            
                    
                        <b>3.11.</b>
                    
                    Appendix K: RBAC RoleBinding and ClusterRoleBinding examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12" data-path="appendix/l.html">
            
                <a href="appendix/l.html">
            
                    
                        <b>3.12.</b>
                    
                    Appendix L: Audit Strategy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13" data-path="appendix/m.html">
            
                <a href="appendix/m.html">
            
                    
                        <b>3.13.</b>
                    
                    Appendix M: Example of flags for submitting audit policy files to kube-apiserver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14" data-path="appendix/n.html">
            
                <a href="appendix/n.html">
            
                    
                        <b>3.14.</b>
                    
                    Appendix N: webhook configuration
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Kubernetes Pod Security</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="kubernetes-pod-security">Kubernetes Pod Security</h1>
<p>Pod is the smallest deployable unit in Kubernetes, consisting of one or more containers. Pods are typically the initial execution environment for network actors when leveraging containers. For this reason, Pods should be hardened to make exploitation more difficult and limit the impact of a successful compromise.</p>
<figure id="fig2.3.1"><a href="images/f3.jpg" data-lightbox="09b2fdb0-9de9-4a0a-92ae-8f62ddadbc42" data-title="Figure 3: Pod component with sidecar proxy as log container"><img src="images/f3.jpg" alt="Figure 3: Pod component with sidecar proxy as log container"></a><figcaption>Figure 3: Pod component with sidecar proxy as log container</figcaption></figure>
<h2 id="non-root-containers-and-no-root-container-engines">&quot;Non-root&quot; containers and &quot;no-root&quot; container engines</h2>
<p>By default, many container services run as the privileged root user, and applications execute as root within the container, although privileged execution is not required.</p>
<p>You can limit the impact of a compromised container by using non-root containers or a rootless container engine to prevent root execution. Both methods can have a significant impact on the runtime environment, so applications should be fully tested to ensure compatibility.</p>
<p><strong>Non-root containers</strong>: Container Engine allows containers to run applications as non-root users and non-root group members. Typically, this non-default setting is configured when building the container image. <strong><a href="appendix/a.html">Appendix A: Example Dockerfile for non-root applications</a></strong> shows an example Dockerfile that runs an application as a non-root user.</p>
<p><strong>Non-root user</strong>. Additionally, Kubernetes can load containers into Pods when <code>SecurityContext:runAsUser</code> specifies a non-zero user. While the <code>runAsUser</code> directive effectively forces non-root execution at deployment time, the NSA and CISA encourage developers to build container applications that execute as a non-root user. Integrating non-root execution at build time provides better assurance that your application will function properly without root privileges.</p>
<p><strong>Rootless Container Engines</strong>: Some container engines can run in an unprivileged context instead of using a daemon that runs as root. In this case, from the perspective of the containerized application, execution appears to be using the root user, but execution is remapped to the engine user context on the host machine. While rootless container engines add an effective layer of security, many engines are currently released as experimental and should not be used in production environments. Administrators should be aware of this emerging technology and look to adopt rootless container engines when vendors release stable versions that are compatible with Kubernetes.</p>
<h2 id="immutable-container-file-system">Immutable container file system</h2>
<p>By default, containers are allowed to execute without restrictions in their own context. A cyber actor who gains execution permissions within a container can create files, download scripts, and modify applications within the container. Kubernetes can lock down a container&apos;s file system, preventing many post-exposure activities.</p>
<p>However, these limitations also affect legitimate container applications and can cause crashes or unexpected behavior. To prevent compromise of legitimate applications, Kubernetes administrators can mount a secondary read/write file system for specific directories that applications require write access to. <strong><a href="appendix/b.html">Appendix B: Deployment template example for a read-only file system</a></strong> shows an example of an immutable container with a writable directory.</p>
<h2 id="build-secure-container-images">Build secure container images</h2>
<p>Container images are typically created by building a container from scratch or by building on an existing image pulled from a repository. In addition to using trusted repositories to build containers, image scanning is key to ensuring the security of deployed containers. Throughout the container build workflow, images should be scanned to identify outdated libraries, known vulnerabilities, or misconfigurations such as insecure ports or permissions.</p>
<figure id="fig2.3.2"><a href="images/f4.jpg" data-lightbox="d9e9c635-3d0b-444e-b80d-bc810304d86d" data-title="Figure 4: Container build workflow, optimized with webhook and admission controller"><img src="images/f4.jpg" alt="Figure 4: Container build workflow, optimized with webhook and admission controller"></a><figcaption>Figure 4: Container build workflow, optimized with webhook and admission controller</figcaption></figure>
<p>One way to implement image scanning is to use an admission controller. Admission controllers are a native feature of Kubernetes that intercept and handle requests to the Kubernetes API before the object is persisted, but after the request has been authenticated and authorized. A custom or proprietary webhook can be implemented to perform a scan before any image is deployed in the cluster. This admission controller can prevent deployment if the image complies with the organization&apos;s security policy defined in the webhook configuration.</p>
<h2 id="pod-security-policy">Pod Security Policy</h2>
<blockquote>
<p>Pod creation should comply with the principle of least authorization.</p>
</blockquote>
<p>The Pod Security Policy (PSP) <sup><a href="#fn_1" id="reffn_1">1</a></sup> is a cluster-wide policy that specifies the security requirements/defaults for Pods to execute within the cluster. While security mechanisms are typically specified in the Pod/Deployment configuration, PSP establishes a minimum security threshold that all Pods must adhere to. Some PSP fields provide default values that are used when a Pod&apos;s configuration omits a field. Other PSP fields are used to deny the creation of Pods that do not meet the requirements. PSP is performed through the Kubernetes admission controller, so PSP can only perform requirements during Pod creation. PSP does not affect Pods already running in the cluster.</p>
<p>PSP is useful for enforcing security measures in a cluster. PSP is particularly effective for clusters managed by administrators with hierarchical roles. In these cases, top-level administrators can impose defaults and enforce requirements on lower-level administrators. The NSA and CISA encourage enterprises to adapt the Kubernetes hardened PSP template in <a href="appendix/c.html">Appendix C: Example Pod Security Policy</a> to their needs. The following table describes some of the widely available PSP components.</p>
<p><strong>&#x8868; 1: Pod &#x5B89;&#x5168;&#x7B56;&#x7565;&#x7EC4;&#x4EF6;</strong></p>
<table>
<thead>
<tr>
<th>&#x5B57;&#x6BB5;&#x540D;&#x79F0;</th>
<th>&#x4F7F;&#x7528;&#x65B9;&#x6CD5;</th>
<th>&#x5EFA;&#x8BAE;</th>
</tr>
</thead>
<tbody>
<tr>
<td>privileged</td>
<td>&#x63A7;&#x5236; Pod &#x662F;&#x5426;&#x53EF;&#x4EE5;&#x8FD0;&#x884C;&#x6709;&#x7279;&#x6743;&#x7684;&#x5BB9;&#x5668;&#x3002;</td>
<td>&#x8BBE;&#x7F6E;&#x4E3A; false&#x3002;</td>
</tr>
<tr>
<td>hostPID&#x3001;hostIPC</td>
<td>&#x63A7;&#x5236;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x5171;&#x4EAB;&#x4E3B;&#x673A;&#x8FDB;&#x7A0B;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x3002;</td>
<td>&#x8BBE;&#x7F6E;&#x4E3A; false&#x3002;</td>
</tr>
<tr>
<td>hostNetwork</td>
<td>&#x63A7;&#x5236;&#x5BB9;&#x5668;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4E3B;&#x673A;&#x7F51;&#x7EDC;&#x3002;</td>
<td>&#x8BBE;&#x7F6E;&#x4E3A; false&#x3002;</td>
</tr>
<tr>
<td>allowedHostPaths</td>
<td>&#x5C06;&#x5BB9;&#x5668;&#x9650;&#x5236;&#x5728;&#x4E3B;&#x673A;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x7279;&#x5B9A;&#x8DEF;&#x5F84;&#x4E0A;&#x3002;</td>
<td>&#x4F7F;&#x7528;&#x4E00;&#x4E2A; &quot;&#x5047;&#x7684;&quot; &#x8DEF;&#x5F84;&#x540D;&#x79F0;&#xFF08;&#x6BD4;&#x5982; <code>/foo</code> &#x6807;&#x8BB0;&#x4E3A;&#x53EA;&#x8BFB;&#xFF09;&#x3002;&#x7701;&#x7565;&#x8FD9;&#x4E2A;&#x5B57;&#x6BB5;&#x7684;&#x7ED3;&#x679C;&#x662F;&#x4E0D;&#x5BF9;&#x5BB9;&#x5668;&#x8FDB;&#x884C;&#x51C6;&#x5165;&#x9650;&#x5236;&#x3002;</td>
</tr>
<tr>
<td>readOnlyRootFilesystem</td>
<td>&#x9700;&#x8981;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x53EA;&#x8BFB;&#x7684;&#x6839;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3002;</td>
<td>&#x53EF;&#x80FD;&#x65F6;&#x8BBE;&#x7F6E;&#x4E3A; true&#x3002;</td>
</tr>
<tr>
<td>runAsUser, runAsGroup, supplementalGroups, fsGroup</td>
<td>&#x63A7;&#x5236;&#x5BB9;&#x5668;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x662F;&#x5426;&#x80FD;&#x4EE5; root &#x6743;&#x9650;&#x6216; root &#x7EC4;&#x6210;&#x5458;&#x8EAB;&#x4EFD;&#x8FD0;&#x884C;&#x3002;</td>
<td>- &#x8BBE;&#x7F6E; <code>runAsUser</code> &#x4E3A; <code>MustRunAsNonRoot</code>&#x3002;- &#x5C06; <code>runAsGroup</code> &#x8BBE;&#x7F6E;&#x4E3A;&#x975E;&#x96F6;&#xFF08;&#x53C2;&#x89C1;<a href="appendix/c.html">&#x9644;&#x5F55; C</a> &#x4E2D;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;Pod &#x5B89;&#x5168;&#x7B56;&#x7565;&#x793A;&#x4F8B;&#xFF09;&#x3002;</td>
</tr>
<tr>
<td></td>
<td></td>
<td>&#x5C06; <code>supplementalGroups</code> &#x8BBE;&#x7F6E;&#x4E3A;&#x975E;&#x96F6;&#xFF08;&#x89C1;&#x9644;&#x5F55; C &#x7684;&#x4F8B;&#x5B50;&#xFF09;&#x3002;&#x5C06; <code>fsGroup</code> &#x8BBE;&#x7F6E;&#x4E3A;&#x975E;&#x96F6;&#xFF08;&#x53C2;&#x89C1;<a href="appendix/c.html">&#x9644;&#x5F55; C</a> &#x4E2D;&#x7684;&#x4F8B;&#x5B50;&#xFF1A;Pod &#x5B89;&#x5168;&#x7B56;&#x7565;&#x793A;&#x4F8B;&#xFF09;&#x3002;</td>
</tr>
<tr>
<td>allowPrivilegeEscalation</td>
<td>&#x9650;&#x5236;&#x5347;&#x7EA7;&#x5230; root &#x6743;&#x9650;&#x3002;</td>
<td>&#x8BBE;&#x7F6E;&#x4E3A; false&#x3002;&#x4E3A;&#x4E86;&#x6709;&#x6548;&#x5730;&#x6267;&#x884C; <code>runAsUser: MustRunAsNonRoot</code> &#x8BBE;&#x7F6E;&#xFF0C;&#x9700;&#x8981;&#x91C7;&#x53D6;&#x8FD9;&#x4E00;&#x63AA;&#x65BD;&#x3002;</td>
</tr>
<tr>
<td>seLinux</td>
<td>&#x8BBE;&#x7F6E;&#x5BB9;&#x5668;&#x7684; SELinux &#x4E0A;&#x4E0B;&#x6587;&#x3002;</td>
<td>&#x5982;&#x679C;&#x73AF;&#x5883;&#x652F;&#x6301; SELinux&#xFF0C;&#x53EF;&#x4EE5;&#x8003;&#x8651;&#x6DFB;&#x52A0; SELinux &#x6807;&#x7B7E;&#x4EE5;&#x8FDB;&#x4E00;&#x6B65;&#x52A0;&#x56FA;&#x5BB9;&#x5668;&#x3002;</td>
</tr>
<tr>
<td>AppArmor &#x6CE8;&#x89E3;</td>
<td>&#x8BBE;&#x7F6E;&#x5BB9;&#x5668;&#x6240;&#x4F7F;&#x7528;&#x7684; AppArmor &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</td>
<td>&#x5728;&#x53EF;&#x80FD;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x901A;&#x8FC7;&#x91C7;&#x7528; AppArmor &#x6765;&#x9650;&#x5236;&#x5F00;&#x53D1;&#xFF0C;&#x4EE5;&#x52A0;&#x56FA;&#x5BB9;&#x5668;&#x5316;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;</td>
</tr>
<tr>
<td>seccomp &#x6CE8;&#x89E3;</td>
<td>&#x8BBE;&#x7F6E;&#x7528;&#x4E8E;&#x6C99;&#x76D2;&#x5BB9;&#x5668;&#x7684; seccomp &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x3002;</td>
<td>&#x5728;&#x53EF;&#x80FD;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4F7F;&#x7528; seccomp &#x5BA1;&#x8BA1;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6765;&#x8BC6;&#x522B;&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6240;&#x9700;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF1B;&#x7136;&#x540E;&#x542F;&#x7528; seccomp &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x6765;&#x963B;&#x6B62;&#x6240;&#x6709;&#x5176;&#x4ED6;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002;</td>
</tr>
</tbody>
</table>
<p><strong>&#x6CE8;&#x610F;</strong>&#xFF1A;&#x7531;&#x4E8E;&#x4EE5;&#x4E0B;&#x539F;&#x56E0;&#xFF0C;PSP &#x4E0D;&#x4F1A;&#x81EA;&#x52A8;&#x9002;&#x7528;&#x4E8E;&#x6574;&#x4E2A;&#x96C6;&#x7FA4;&#xFF1A;</p>
<ul>
<li>&#x9996;&#x5148;&#xFF0C;&#x5728;&#x5E94;&#x7528; PSP &#x4E4B;&#x524D;&#xFF0C;&#x5FC5;&#x987B;&#x4E3A; Kubernetes &#x51C6;&#x5165;&#x63A7;&#x5236;&#x5668;&#x542F;&#x7528; <code>PodSecurityPolicy</code> &#x63D2;&#x4EF6;&#xFF0C;&#x8FD9;&#x662F; <code>kube-apiserver</code> &#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</li>
<li>&#x7B2C;&#x4E8C;&#xFF0C;&#x7B56;&#x7565;&#x5FC5;&#x987B;&#x901A;&#x8FC7; RBAC &#x6388;&#x6743;&#x3002;&#x7BA1;&#x7406;&#x5458;&#x5E94;&#x4ECE;&#x5176;&#x96C6;&#x7FA4;&#x7EC4;&#x7EC7;&#x5185;&#x7684;&#x6BCF;&#x4E2A;&#x89D2;&#x8272;&#x4E2D;&#x9A8C;&#x8BC1;&#x5DF2;&#x5B9E;&#x65BD;&#x7684; PSP &#x7684;&#x6B63;&#x786E;&#x529F;&#x80FD;&#x3002;</li>
</ul>
<p>&#x5728;&#x6709;&#x591A;&#x4E2A; PSP &#x7684;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x7BA1;&#x7406;&#x5458;&#x5E94;&#x8BE5;&#x8C28;&#x614E;&#x884C;&#x4E8B;&#xFF0C;&#x56E0;&#x4E3A; Pod &#x7684;&#x521B;&#x5EFA;&#x4F1A;&#x9075;&#x5B88;<strong>&#x6700;&#x5C0F;&#x9650;&#x5236;&#x6027;</strong>&#x6388;&#x6743;&#x7B56;&#x7565;&#x3002;&#x4EE5;&#x4E0B;&#x547D;&#x4EE4;&#x63CF;&#x8FF0;&#x4E86;&#x7ED9;&#x5B9A;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7684;&#x6240;&#x6709; Pod &#x5B89;&#x5168;&#x7B56;&#x7565;&#xFF0C;&#x8FD9;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x8BC6;&#x522B;&#x6709;&#x95EE;&#x9898;&#x7684;&#x91CD;&#x53E0;&#x7B56;&#x7565;&#x3002;</p>
<pre class="language-"><code class="lang-sh">kubectl get psp -n <span class="token operator">&lt;</span>namespace<span class="token operator">&gt;</span>
</code></pre>
<h2 id="protect-pod-service-account-token">Protect Pod Service Account Token</h2>
<p>By default, Kubernetes automatically provides a service account (Service Account) when creating a Pod, and mounts the account&apos;s secret token (token) in the Pod at runtime. Many containerized applications do not require direct access to service accounts because Kubernetes orchestration happens transparently in the background. If an application is broken. Account tokens in Pods can be collected by network actors and used to further compromise the cluster. When an application does not require direct access to a service account, Kubernetes administrators should ensure that the Pod specification disables loading secret tokens. This can be done via the <code>automountServiceAccountToken: false</code> directive in the Pod&apos;s YAML specification.</p>
<h2 id="harden-container-engine">Harden container engine</h2>
<p>Some platforms and container engines provide additional options to harden containerized environments. A powerful example is using a hypervisor to provide container isolation. The hypervisor relies on hardware to enforce virtualization boundaries, not the operating system. Hypervisor isolation is more secure than traditional container isolation. Container engines running on Windows&#xAE; operating systems can be configured to use the built-in Windows hypervisor Hyper-V&#xAE; for enhanced security.</p>
<p>Additionally, some security-focused container engines deploy each container within a lightweight hypervisor to achieve defense in depth. Hypervisor-backed containers can reduce container breaches.</p>
<blockquote id="fn_1">
<sup>1</sup>. Translator&apos;s Note: Pod Security Policy has been announced to be deprecated in version 1.21. As a replacement, 1.22 introduced the built-in Pod Security Admission controller and the new Pod Security Standards standard. <a href="https://kubernetes.io/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/" target="_blank">Source</a><a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#x21A9;</a>
</blockquote>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; 2023 - 2024 | <a href="https://seifrajhi.github.io/" target="_blank"> Saif(eddine) Rajhi </a> all right reserved.</span><span class="footer-modification"> Updated at 
2024-02-23 11:20:28
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="threat-model.html" class="navigation navigation-prev " aria-label="Previous page: Threat Modeling">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="network-separation-and-hardening.html" class="navigation navigation-next " aria-label="Next page: Network isolation and hardening">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Kubernetes Pod Security","level":"2.3","depth":1,"next":{"title":"Network isolation and hardening","level":"2.4","depth":1,"path":"network-separation-and-hardening.md","ref":"network-separation-and-hardening.md","articles":[]},"previous":{"title":"Threat Modeling","level":"2.2","depth":1,"path":"threat-model.md","ref":"threat-model.md","articles":[]},"dir":"ltr"},"config":{"plugins":["github","codesnippet","splitter","page-toc-button","image-captions","editlink","back-to-top-button","-lunr","-search","search-plus","github-buttons@2.1.0","favicon@^0.0.2","tbfed-pagefooter@^0.0.1","theme-default","-highlight","prism","prism-themes","lightbox","sitemap-general","insert-logo","hide-element","adsense"],"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright Â© 2023 - 2024 | <a href =https://seifrajhi.github.io/> Saif(eddine) Rajhi </a>","modify_label":" Updated at ","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prism-themes/themes/prism-ghcolors.css"]},"github":{"url":"https://github.com/seifrajhi/kubernetes-hardening-checklist-guidance"},"editlink":{"label":"Edit this page","multilingual":false,"base":"https://github.com/seifrajhi/kubernetes-hardening-checklist-guidance/blob/main/"},"splitter":{},"adsense":{"client":"ca-pub-4029167986768912","slot":"2445941692","format":"auto","element":".page-inner section","position":"bottom"},"codesnippet":{},"sitemap-general":{"prefix":"https://seifrajhi.github.io/kubernetes-hardening-checklist-guidance/"},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"favicon":{"shortcut":"favicon.ico","bookmark":"favicon.ico"},"lightbox":{"jquery":true,"sameUuid":false},"page-toc-button":{},"back-to-top-button":{},"prism-themes":{},"github-buttons":{"repo":"seifrajhi/kubernetes-hardening-checklist-guidance","types":["star"],"size":"small"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"showLevel":true,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}},"insert-logo":{"style":"background: none; max-height: 100px; min-height: 30px","url":"https://seifrajhi.github.io/images/favicon.ico"},"search-plus":{},"image-captions":{"caption":"_CAPTION_","variable_name":"_pictures"}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"_pictures":[{"backlink":"introduction.html#fig2.1.1","level":"2.1","list_caption":"Figure: Figure 1: High-level view of Kubernetes cluster components","alt":"Figure 1: High-level view of Kubernetes cluster components","nro":1,"url":"images/f1.jpg","index":1,"caption_template":"_CAPTION_","label":"Figure 1: High-level view of Kubernetes cluster components","attributes":{},"skip":false,"key":"2.1.1"},{"backlink":"introduction.html#fig2.1.2","level":"2.1","list_caption":"Figure: Figure 2: Kubernetes architecture","alt":"Figure 2: Kubernetes architecture","nro":2,"url":"images/f2.jpg","index":2,"caption_template":"_CAPTION_","label":"Figure 2: Kubernetes architecture","attributes":{},"skip":false,"key":"2.1.2"},{"backlink":"kubernetes-pod-security.html#fig2.3.1","level":"2.3","list_caption":"Figure: Figure 3: Pod component with sidecar proxy as log container","alt":"Figure 3: Pod component with sidecar proxy as log container","nro":3,"url":"images/f3.jpg","index":1,"caption_template":"_CAPTION_","label":"Figure 3: Pod component with sidecar proxy as log container","attributes":{},"skip":false,"key":"2.3.1"},{"backlink":"kubernetes-pod-security.html#fig2.3.2","level":"2.3","list_caption":"Figure: Figure 4: Container build workflow, optimized with webhook and admission controller","alt":"Figure 4: Container build workflow, optimized with webhook and admission controller","nro":4,"url":"images/f4.jpg","index":2,"caption_template":"_CAPTION_","label":"Figure 4: Container build workflow, optimized with webhook and admission controller","attributes":{},"skip":false,"key":"2.3.2"},{"backlink":"logging.html#fig2.6.1","level":"2.6","list_caption":"Figure: Figure 5: Cluster leverages service mesh to combine logs with network security","alt":"Figure 5: Cluster leverages service mesh to combine logs with network security","nro":5,"url":"images/f5.jpg","index":1,"caption_template":"_CAPTION_","label":"Figure 5: Cluster leverages service mesh to combine logs with network security","attributes":{},"skip":false,"key":"2.6.1"}]},"title":"Kubernetes Hardening Guide (Produced by the National Security Agency)","links":{"sidebar":{"Return to home page":"https://seifrajhi.github.io/kubernetes-hardening-checklist-guidance"}},"gitbook":"*","description":""},"file":{"path":"kubernetes-pod-security.md","mtime":"2024-02-23T11:20:28.987Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-02-23T11:20:57.217Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-editlink/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lightbox/js/lightbox.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-insert-logo/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-adsense/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

