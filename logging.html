
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Log Audit · Kubernetes Hardening Guide (Produced by the National Security Agency)</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-image-captions/image-captions.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search-plus/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-prism/prism-ghcolors.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-lightbox/css/lightbox.min.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-insert-logo/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="upgrading-and-application-security-practices.html" />
    
    
    <link rel="prev" href="authentication-and-authorization.html" />
    

    
        <link rel="shortcut icon" href='favicon.ico' type="image/x-icon">
    
    
        <link rel="bookmark" href='favicon.ico' type="image/x-icon">
    
    
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"repo":"seifrajhi/kubernetes-hardening-checklist-guidance","types":["star"],"size":"small"};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://seifrajhi.github.io/kubernetes-hardening-checklist-guidance" target="_blank" class="custom-link">Return to home page</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        <li class="header">start</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                        <b>1.1.</b>
                    
                    Description
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="notices-and-hitory.html">
            
                <a href="notices-and-hitory.html">
            
                    
                        <b>1.2.</b>
                    
                    Notices and History
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="publication-information.html">
            
                <a href="publication-information.html">
            
                    
                        <b>1.3.</b>
                    
                    publication information
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="executive-summary.html">
            
                <a href="executive-summary.html">
            
                    
                        <b>1.4.</b>
                    
                    executive summary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="corrigendum.html">
            
                <a href="corrigendum.html">
            
                    
                        <b>1.5.</b>
                    
                    Corrigendum
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Text</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="introduction.html">
            
                <a href="introduction.html">
            
                    
                        <b>2.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="threat-model.html">
            
                <a href="threat-model.html">
            
                    
                        <b>2.2.</b>
                    
                    Threat Modeling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="kubernetes-pod-security.html">
            
                <a href="kubernetes-pod-security.html">
            
                    
                        <b>2.3.</b>
                    
                    Kubernetes Pod Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="network-separation-and-hardening.html">
            
                <a href="network-separation-and-hardening.html">
            
                    
                        <b>2.4.</b>
                    
                    Network isolation and hardening
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="authentication-and-authorization.html">
            
                <a href="authentication-and-authorization.html">
            
                    
                        <b>2.5.</b>
                    
                    Authentication and Authorization
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.6" data-path="logging.html">
            
                <a href="logging.html">
            
                    
                        <b>2.6.</b>
                    
                    Log Audit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="upgrading-and-application-security-practices.html">
            
                <a href="upgrading-and-application-security-practices.html">
            
                    
                        <b>2.7.</b>
                    
                    Upgrading and application security practices
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Appendix</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="appendix/a.html">
            
                <a href="appendix/a.html">
            
                    
                        <b>3.1.</b>
                    
                    Appendix A: Example Dockerfile for non-root applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="appendix/b.html">
            
                <a href="appendix/b.html">
            
                    
                        <b>3.2.</b>
                    
                    Appendix B: Deployment template example for read-only file system
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="appendix/c.html">
            
                <a href="appendix/c.html">
            
                    
                        <b>3.3.</b>
                    
                    Appendix C: Pod Security Policy Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="appendix/d.html">
            
                <a href="appendix/d.html">
            
                    
                        <b>3.4.</b>
                    
                    Appendix D: Namespace Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="appendix/e.html">
            
                <a href="appendix/e.html">
            
                    
                        <b>3.5.</b>
                    
                    Appendix E: Network Policy Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="appendix/f.html">
            
                <a href="appendix/f.html">
            
                    
                        <b>3.6.</b>
                    
                    Appendix F: LimitRange Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="appendix/g.html">
            
                <a href="appendix/g.html">
            
                    
                        <b>3.7.</b>
                    
                    Appendix G: ResourceQuota Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="appendix/h.html">
            
                <a href="appendix/h.html">
            
                    
                        <b>3.8.</b>
                    
                    Appendix H: Encryption Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="appendix/i.html">
            
                <a href="appendix/i.html">
            
                    
                        <b>3.9.</b>
                    
                    Appendix I: KMS configuration example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10" data-path="appendix/j.html">
            
                <a href="appendix/j.html">
            
                    
                        <b>3.10.</b>
                    
                    Appendix J: pod-reader RBAC role
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11" data-path="appendix/k.html">
            
                <a href="appendix/k.html">
            
                    
                        <b>3.11.</b>
                    
                    Appendix K: RBAC RoleBinding and ClusterRoleBinding examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12" data-path="appendix/l.html">
            
                <a href="appendix/l.html">
            
                    
                        <b>3.12.</b>
                    
                    Appendix L: Audit Strategy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13" data-path="appendix/m.html">
            
                <a href="appendix/m.html">
            
                    
                        <b>3.13.</b>
                    
                    Appendix M: Example of flags for submitting audit policy files to kube-apiserver
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14" data-path="appendix/n.html">
            
                <a href="appendix/n.html">
            
                    
                        <b>3.14.</b>
                    
                    Appendix N: webhook configuration
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Log Audit</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div class="search-plus" id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="log-audit">Log audit</h1>
<p>Logs record activity in the cluster. Audit logs are necessary not only to ensure that services are running and configured as expected, but also to ensure the security of the system. Systematic audits require consistent and thorough examination of security settings to help identify potential threats. Kubernetes is able to capture audit logs of cluster operations and monitor basic CPU and memory usage information; however, it does not provide in-depth monitoring or alerting services.</p>
<p><strong>key point</strong></p>
<ul>
<li>Establish a Pod baseline at creation time to be able to identify anomalous activity.</li>
<li>Logging at the host level, application level and cloud (if applicable).</li>
<li>Integrate existing network security tools for comprehensive scanning, monitoring, alerting and analysis.</li>
<li>Set up local log storage to prevent loss in case of communication failure.</li>
</ul>
<h2 id="log">log</h2>
<p>System administrators running applications in Kubernetes should set up an effective logging, monitoring, and alerting system for their environment. Merely logging Kubernetes events is not enough to get the full picture of the actions taking place on the system. Logging should also be done at the host level, application level, and on the cloud (if applicable). Furthermore, these logs can be correlated with any external certification and system logs to provide a complete view of actions taken across the environment for use by security auditors and incident responders.</p>
<p>In a Kubernetes environment, administrators should monitor/log the following:</p>
<ul>
<li>API request history</li>
<li>Performance</li>
<li>Deployment status</li>
<li>LF</li>
<li>Operating system calls</li>
<li>Changes in protocols and permissions</li>
<li>Network traffic</li>
</ul>
<p>When a Pod is created or updated, administrators should capture detailed logs of network traffic, response times, requests, resource consumption, and any other relevant metrics to establish a baseline. As detailed in the previous section, anonymous accounts should be disabled, but logging policies should still record actions taken by anonymous accounts to identify anomalous activity.</p>
<p>RBAC policy configurations should be audited regularly and whenever there are changes to the organization&apos;s system administrators. Doing so ensures that access control adjustments comply with the RBAC policy hardening guidance outlined in the Role-Based Access Control section.</p>
<p>Audits should include comparing current logs to baseline measurements of normal activity to identify significant changes in any log metrics and events. System administrators should investigate significant changes&#x2014;for example, changes in application usage or the installation of malicious programs such as Cipher to determine the root cause. Internal and external traffic logs should be audited to ensure that all expected security restrictions on the connection have been configured correctly and are functioning as expected. Administrators can also use these audits as the system evolves to determine when external access is no longer needed and can be restricted.</p>
<p>Logs can be directed to external logging services to ensure they are available to security professionals outside the cluster to identify anomalies as close to real-time as possible and protect logs from deletion if a compromise occurs. If using this method, logs should be encrypted in transit with TLS 1.2 or 1.3 to ensure that cyber actors cannot access the logs in transit and gain valuable information about the environment. Another precaution to take when leveraging an external log server is to configure a log forwarder within Kubernetes with append-only access to the external storage. This helps protect externally stored logs from being deleted or overwritten by in-cluster logs.</p>
<h2 id="kubernetes-native-audit-log-configuration">Kubernetes native audit log configuration</h2>
<blockquote>
<p>The audit function of Kubernetes is disabled by default, so if no audit policy is written, there will be no records.</p>
</blockquote>
<p><code>kube-apiserver</code> resides on the Kubernetes control plane and acts as a front-end, handling internal and external requests to the cluster. Every request, whether generated by a user, application, or control plane, generates an audit event at every stage of its execution. When an audit event is registered, kube-apiserver checks the audit policy file and applicable rules. If such a rule exists, the server logs the event at the level defined by the first matching rule. The built-in auditing function of Kubernetes is not enabled by default, so if no audit policy is written, there will be no records.</p>
<p>The cluster administrator must write an audit policy YAML file to establish rules and specify the required audit level to log each type of audit event. This audit policy file is then passed to kube-apiserver with the appropriate flags. For a rule to be considered valid, one of four audit levels must be specified: <code>none</code>, <code>Meatadataa</code>, <code>Request</code>, or <code>RequestResponse</code>. <a href="http://localhost:4000/appendix/l.html" target="_blank"><strong>Appendix L: Audit Policy</strong></a> shows the contents of an audit policy file that records all events at the <code>RequestResponse</code> level. <a href="http://localhost:4000/appendix/m.html" target="_blank"><strong>Appendix M</strong></a> Example of flags for submitting audit policy files to <code>kube-apiserver</code> shows the location of the <code>kube-apiserver</code> configuration file and provides An example of the flags that an audit policy file can be passed to <code>kube-apiserver</code>. Appendix M also provides guidance on how to mount volumes and configure host paths if necessary.</p>
<p><code>kube-apiserver</code> includes configurable logging and webhook backends for audit logs. The logging backend writes specified audit events to a log file, and the webhook backend can be configured to send the file to an external HTTP API. The <code>--audit-log-path</code> and <code>--audit-log-maxage</code> flags set in the example in Appendix M are two examples of ways you can configure a logging backend that writes audit events to a file. The <code>log-path</code> flag is the minimum configuration to enable logging and is the only configuration required for the logging backend. The default format for these log files is JSON, although this can be changed if necessary. Additional configuration options for the logging backend can be found in the Kubernetes documentation.</p>
<p>In order to push audit logs to your organization&apos;s SIEM platform, the webhook backend can be configured manually via a YAML file submitted to <code>kube-apiserver</code>. The webhook configuration file and how to pass it to kube-apiserver can be viewed in the examples at <a href="http://localhost:4000/appendix/n.html" target="_blank"><strong>Appendix N: webhook configuration</strong></a>. An exhaustive list of configuration options on how to set up the webhook backend in <code>kube-apiserver</code> can be found in the Kubernetes documentation.</p>
<h3 id="logging-of-worker-nodes-and-containers">Logging of worker nodes and containers</h3>
<p>There are many ways to configure logging functionality in a Kubernetes architecture. In the built-in method of log management, the kubelet on each node is responsible for managing logs. It stores and rotates log files locally based on its policies for individual file length, storage time, and storage capacity. These logs are controlled by the kubelet and can be accessed from the command line. The following command prints the logs of the containers in a Pod.</p>
<pre class="language-"><code class="lang-sh">kubectl logs <span class="token punctuation">[</span>-f<span class="token punctuation">]</span> <span class="token punctuation">[</span>-p<span class="token punctuation">]</span> POD <span class="token punctuation">[</span>-c CONTAINER<span class="token punctuation">]</span>
</code></pre>
<p>&#x5982;&#x679C;&#x8981;&#x5BF9;&#x65E5;&#x5FD7;&#x8FDB;&#x884C;&#x6D41;&#x5F0F;&#x5904;&#x7406;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>-f</code> &#x6807;&#x5FD7;&#xFF1B;&#x5982;&#x679C;&#x5B58;&#x5728;&#x5E76;&#x9700;&#x8981;&#x6765;&#x81EA;&#x5BB9;&#x5668;&#x5148;&#x524D;&#x5B9E;&#x4F8B;&#x7684;&#x65E5;&#x5FD7;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>-p</code> &#x6807;&#x5FD7;&#xFF1B;&#x5982;&#x679C; Pod &#x4E2D;&#x6709;&#x591A;&#x4E2A;&#x5BB9;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>-c</code> &#x6807;&#x5FD7;&#x6765;&#x6307;&#x5B9A;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x3002;&#x5982;&#x679C;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#x5BFC;&#x81F4;&#x5BB9;&#x5668;&#x3001;Pod &#x6216;&#x8282;&#x70B9;&#x6B7B;&#x4EA1;&#xFF0C;Kubernetes &#x4E2D;&#x7684;&#x672C;&#x5730;&#x65E5;&#x5FD7;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x5E76;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x6765;&#x4FDD;&#x5B58;&#x5B58;&#x50A8;&#x5728;&#x5931;&#x8D25;&#x5BF9;&#x8C61;&#x4E2D;&#x7684;&#x65E5;&#x5FD7;&#x3002;NSA &#x548C; CISA &#x5EFA;&#x8BAE;&#x914D;&#x7F6E;&#x4E00;&#x4E2A;&#x8FDC;&#x7A0B;&#x65E5;&#x5FD7;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x4EE5;&#x4FBF;&#x5728;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x5931;&#x8D25;&#x65F6;&#x4FDD;&#x5B58;&#x65E5;&#x5FD7;&#x3002;</p>
<p>&#x8FDC;&#x7A0B;&#x8BB0;&#x5F55;&#x7684;&#x9009;&#x9879;&#x5305;&#x62EC;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x8FDC;&#x7A0B;&#x65E5;&#x5FD7;&#x9009;&#x9879;</th>
<th>&#x4F7F;&#x7528;&#x7684;&#x7406;&#x7531;</th>
<th>&#x914D;&#x7F6E;&#x5B9E;&#x65BD;</th>
</tr>
</thead>
<tbody>
<tr>
<td>&#x5728;&#x6BCF;&#x4E2A;&#x8282;&#x70B9;&#x4E0A;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;&#x65E5;&#x5FD7;&#x4EE3;&#x7406;&#xFF0C;&#x5C06;&#x65E5;&#x5FD7;&#x63A8;&#x9001;&#x5230;&#x540E;&#x7AEF;</td>
<td>&#x8D4B;&#x4E88;&#x8282;&#x70B9;&#x66B4;&#x9732;&#x65E5;&#x5FD7;&#x6216;&#x5C06;&#x65E5;&#x5FD7;&#x63A8;&#x9001;&#x5230;&#x540E;&#x7AEF;&#x7684;&#x80FD;&#x529B;&#xFF0C;&#x5728;&#x53D1;&#x751F;&#x6545;&#x969C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5C06;&#x5176;&#x4FDD;&#x5B58;&#x5728;&#x8282;&#x70B9;&#x4E4B;&#x5916;&#x3002;</td>
<td>&#x914D;&#x7F6E;&#x4E00;&#x4E2A; Pod &#x4E2D;&#x7684;&#x72EC;&#x7ACB;&#x5BB9;&#x5668;&#x4F5C;&#x4E3A;&#x65E5;&#x5FD7;&#x4EE3;&#x7406;&#x8FD0;&#x884C;&#xFF0C;&#x8BA9;&#x5B83;&#x8BBF;&#x95EE;&#x8282;&#x70B9;&#x7684;&#x5E94;&#x7528;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#xFF0C;&#x5E76;&#x914D;&#x7F6E;&#x5B83;&#x5C06;&#x65E5;&#x5FD7;&#x8F6C;&#x53D1;&#x5230;&#x7EC4;&#x7EC7;&#x7684; SIEM&#x3002;</td>
</tr>
<tr>
<td>&#x5728;&#x6BCF;&#x4E2A; Pod &#x4E2D;&#x4F7F;&#x7528;&#x4E00;&#x4E2A; sidecar &#x5BB9;&#x5668;&#xFF0C;&#x5C06;&#x65E5;&#x5FD7;&#x63A8;&#x9001;&#x5230;&#x4E00;&#x4E2A;&#x8F93;&#x51FA;&#x6D41;&#x4E2D;</td>
<td>&#x7528;&#x4E8E;&#x5C06;&#x65E5;&#x5FD7;&#x63A8;&#x9001;&#x5230;&#x72EC;&#x7ACB;&#x7684;&#x8F93;&#x51FA;&#x6D41;&#x3002;&#x5F53;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5BB9;&#x5668;&#x5199;&#x5165;&#x4E0D;&#x540C;&#x683C;&#x5F0F;&#x7684;&#x591A;&#x4E2A;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x8FD9;&#x53EF;&#x80FD;&#x662F;&#x4E00;&#x4E2A;&#x6709;&#x7528;&#x7684;&#x9009;&#x9879;&#x3002;</td>
<td>&#x4E3A;&#x6BCF;&#x79CD;&#x65E5;&#x5FD7;&#x7C7B;&#x578B;&#x914D;&#x7F6E; sidecar &#x5BB9;&#x5668;&#xFF0C;&#x5E76;&#x7528;&#x4E8E;&#x5C06;&#x8FD9;&#x4E9B;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x91CD;&#x5B9A;&#x5411;&#x5230;&#x5B83;&#x4EEC;&#x5404;&#x81EA;&#x7684;&#x8F93;&#x51FA;&#x6D41;&#xFF0C;&#x5728;&#x90A3;&#x91CC;&#x5B83;&#x4EEC;&#x53EF;&#x4EE5;&#x88AB; kubelet &#x5904;&#x7406;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x8282;&#x70B9;&#x7EA7;&#x7684;&#x65E5;&#x5FD7;&#x4EE3;&#x7406;&#x53EF;&#x4EE5;&#x5C06;&#x8FD9;&#x4E9B;&#x65E5;&#x5FD7;&#x8F6C;&#x53D1;&#x7ED9; SIEM &#x6216;&#x5176;&#x4ED6;&#x540E;&#x7AEF;&#x3002;</td>
</tr>
<tr>
<td>&#x5728;&#x6BCF;&#x4E2A; Pod &#x4E2D;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x65E5;&#x5FD7;&#x4EE3;&#x7406; sidecar&#xFF0C;&#x5C06;&#x65E5;&#x5FD7;&#x63A8;&#x9001;&#x5230;&#x540E;&#x7AEF;</td>
<td>&#x5F53;&#x9700;&#x8981;&#x6BD4;&#x8282;&#x70B9;&#x7EA7;&#x65E5;&#x5FD7;&#x4EE3;&#x7406;&#x6240;&#x80FD;&#x63D0;&#x4F9B;&#x7684;&#x66F4;&#x591A;&#x7075;&#x6D3B;&#x6027;&#x65F6;&#x3002;</td>
<td>&#x4E3A;&#x6BCF;&#x4E2A; Pod &#x914D;&#x7F6E;&#xFF0C;&#x5C06;&#x65E5;&#x5FD7;&#x76F4;&#x63A5;&#x63A8;&#x9001;&#x5230;&#x540E;&#x7AEF;&#x3002;&#x8FD9;&#x662F;&#x8FDE;&#x63A5;&#x7B2C;&#x4E09;&#x65B9;&#x65E5;&#x5FD7;&#x4EE3;&#x7406;&#x548C;&#x540E;&#x7AEF;&#x7684;&#x5E38;&#x7528;&#x65B9;&#x6CD5;&#x3002;</td>
</tr>
<tr>
<td>&#x4ECE;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x76F4;&#x63A5;&#x5411;&#x540E;&#x7AEF;&#x63A8;&#x9001;&#x65E5;&#x5FD7;</td>
<td>&#x6355;&#x83B7;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;&#x65E5;&#x5FD7;&#x3002;Kubernetes &#x6CA1;&#x6709;&#x5185;&#x7F6E;&#x7684;&#x673A;&#x5236;&#x76F4;&#x63A5;&#x6765;&#x66B4;&#x9732;&#x6216;&#x63A8;&#x9001;&#x65E5;&#x5FD7;&#x5230;&#x540E;&#x7AEF;&#x3002;</td>
<td>&#x5404;&#x7EC4;&#x7EC7;&#x5C06;&#x9700;&#x8981;&#x5728;&#x5176;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x5EFA;&#x7ACB;&#x8FD9;&#x4E00;&#x529F;&#x80FD;&#xFF0C;&#x6216;&#x9644;&#x52A0;&#x4E00;&#x4E2A;&#x6709;&#x4FE1;&#x8A89;&#x7684;&#x7B2C;&#x4E09;&#x65B9;&#x5DE5;&#x5177;&#x6765;&#x5B9E;&#x73B0;&#x8FD9;&#x4E00;&#x529F;&#x80FD;&#x3002;</td>
</tr>
</tbody>
</table>
<p>Sidecar containers run in a Pod along with other containers and can be configured to stream logs to a log file or a logging backend. A sidecar container can also be configured to act as a traffic proxy for another standard functionality container, which is packaged and deployed.</p>
<p>To ensure continuity of these logging agents across worker nodes, they are typically run as a DaemonSet. Configuring a DaemonSet for this approach ensures that there is a copy of the logging agent on each node and that any changes made to the logging agent are consistent across the cluster.</p>
<h3 id="seccomp-audit-mode">Seccomp: Audit mode</h3>
<p>In addition to the node and container logs mentioned above, it can also be very beneficial to log system calls. One way to audit container system calls in Kubernetes is to use the Secure Compute Mode (seccomp) tool. This tool is disabled by default, but can be used to limit the system call capabilities of the container, thereby reducing the kernel&apos;s attack surface. Seccomp can also log ongoing calls through the use of audit profiles.</p>
<p>A custom seccomp configuration file is used to define which system calls are allowed, and the default action for unspecified calls. To enable a custom seccomp profile in a Pod, Kubernetes administrators can write their seccomp profile JSON file to the <code>/var/lib/kubelet/seccomp/</code> directory and add <code>seccompProfile</code> to the Pod&apos;s <code>securityContext</code>. The custom <code>seccompProfile</code> should also include two fields. <code>Type: Localhost</code> and <code>localhostProfile: myseccomppolicy.json</code>. Logging all system calls can help administrators understand which system calls are required for standard operation, allowing them to further restrict seccomp profiles without losing system functionality.</p>
<h3 id="syslog">SYSLOG</h3>
<p>Kubernetes writes kubelet logs and container runtime logs to journald by default, if that service is available. If organizations want to use the syslog tool for systems that are not used by default, or to collect logs from an entire cluster and forward them to a syslog server or other log storage and aggregation platform, they can manually configure this feature. The Syslog protocol defines a log information formatting standard. Syslog messages include a header consisting of a timestamp, hostname, application name, and process ID (PID), and a message written in clear text. Syslog services, such as syslog-ng&#xAE; and rsyslog, can collect and summarize logs from the entire system in a unified format. Many Linux operating systems default to rsyslog or journald - an event logging daemon that optimizes log storage and outputs logs in syslog format via journalctl. On nodes running some Linux distributions, the syslog tool logs events at the operating system level by default. Containers running these Linux distributions also use syslog to collect logs by default. Logs collected by the syslog tool are stored in the local file system of each applicable node or container, unless a log aggregation platform is configured to collect them.</p>
<h2 id="siem-platform">SIEM Platform</h2>
<p>Security information and event management (SIEM) software collects logs from across an organization&apos;s network. SIEM software brings together firewall logs, application logs, and more; parses them out to provide a centralized platform from which analysts can monitor system security. SIEM tools vary in functionality. Generally, these platforms provide log collection, threat detection, and alerting capabilities. Some include machine learning capabilities that can better predict system behavior and help reduce false alarms. Organizations using these platforms in their environments can integrate them with Kubernetes to better monitor and secure their clusters. Open source platforms for managing logs in Kubernetes environments exist as alternatives to SIEM platforms.</p>
<p>Containerized environments have many interdependencies between nodes, pods, containers, and services. In these environments, pods and containers are constantly being shut down and restarted on different nodes. This creates additional challenges for traditional SIEMs, which typically use IP addresses to correlate logs. Even next-generation SIEM platforms are not necessarily suitable for complex Kubernetes environments. However, as Kubernetes has become the most widely used container orchestration platform, many organizations developing SIEM tools have developed product variations specifically for Kubernetes environments, providing comprehensive monitoring solutions for these containerized environments. Administrators should understand the capabilities of their platform and ensure their logs adequately capture the environment to support future incident response.</p>
<h2 id="alert">Alert</h2>
<p>Kubernetes does not natively support alerting; however, some monitoring tools with alerting capabilities are compatible with Kubernetes. If a Kubernetes administrator chooses to configure an alerting tool to work in a Kubernetes environment, there are several indicators that the administrator should monitor and configure alerts for.</p>
<p>Cases that may trigger an alert include, but are not limited to:</p>
<ul>
<li>Disk space is low on any machine in the environment.</li>
<li>The available storage space on the recording volume is decreasing.</li>
<li>The external log service is offline.</li>
<li>A Pod or application running with root privileges.</li>
<li>A request made by an account for a resource to which they do not have permission.</li>
<li>An anonymous account that is using or gaining privileges.</li>
<li>The IP address of the pod or worker node is listed as the source ID of the pod creation request.</li>
<li>Abnormal system calls or failed API calls.</li>
<li>The user/admin is behaving unusually (i.e. at an unusual time or from an unusual location), and</li>
<li>Significant deviation from the standard operating indicator baseline.</li>
</ul>
<p>Alerting when storage is low can help avoid performance issues and log loss due to limited resources and help identify malicious cryptojacking attempts. Privileged Pod execution cases can be investigated to determine whether an administrator made a mistake, a real use case requires escalating privileges, or a malicious actor deployed a privileged Pod. Suspicious Pod creation source IP addresses may indicate that a malicious network actor has breached the container and attempted to create a malicious Pod.</p>
<p>Integrating Kubernetes with an enterprise&apos;s existing SIEM platforms, especially those with machine learning/big data capabilities, can help identify violations in audit logs and reduce false alarms. If such a tool is configured to work with Kubernetes, it should be configured to trigger alerts for these conditions and any other conditions applicable to the use case.</p>
<p>Systems capable of taking automated action when a suspected intrusion occurs can potentially be configured to take steps to mitigate damage as administrators respond to alerts. In cases where a Pod IP is listed as the source ID of a Pod creation request, one mitigation that can be implemented is to automatically evict the Pod to keep the application available but temporarily halt any damage to the cluster. Doing so will allow a clean pod version to be rescheduled onto a node. Investigators can then examine the logs to determine whether a breach occurred and, if so, investigate how the malicious actor carried out the potential threat so that a patch can be deployed.</p>
<h2 id="service-grid">Service Grid</h2>
<p>A service mesh is a platform that simplifies microservice communication within an application by allowing these communication logic to be encoded into the service mesh, rather than within each microservice. Encoding this communication logic into individual microservices is difficult to scale, difficult to debug when failures occur, and difficult to ensure security. Using a service mesh simplifies a developer&apos;s job. A service mesh can:</p>
<ul>
<li>Redirect traffic when a service is interrupted.</li>
<li>Collect performance metrics to optimize communications.</li>
<li>Allows management of service-to-service communication encryption.</li>
<li>Collect logs of inter-service communications.</li>
<li>Collect logs from each service.</li>
<li>Help developers diagnose problems and failures in microservices or communication mechanisms.</li>
</ul>
<p>Service meshes can also help migrate services to hybrid or multi-cloud environments. While service meshes are not required, they are an option that is highly suitable for Kubernetes environments. Managed Kubernetes services typically include their own service mesh. However, several other platforms are available and can be highly customized if desired. Some include a certificate authority that generates and rotates certificates, allowing secure TLS authentication between services. Administrators should consider using a service mesh to harden the security of their Kubernetes clusters.</p>
<figure id="fig2.6.1"><a href="images/f5.jpg" data-lightbox="e0f31668-c43b-4516-a74b-d604fc9b5578" data-title="Figure 5: Cluster leverages service mesh to combine logs with network security"><img src="images/f5.jpg" alt="Figure 5: Cluster leverages service mesh to combine logs with network security"></a><figcaption>Figure 5: Cluster leverages service mesh to combine logs with network security</figcaption></figure>
<h2 id="fault-tolerance">Fault Tolerance</h2>
<p>A fault tolerance strategy should be developed to ensure the availability of the log service. These strategies can vary based on the specific Kubernetes use case. One strategy that can be implemented is to allow new logs to overwrite the oldest log files if it is absolutely necessary to exceed storage capacity.</p>
<p>If logs are sent to an external service, a mechanism should be established to store the logs locally in the event of a communication interruption or external service failure. Once communication with the external service is restored, a strategy should be developed to push locally stored logs to the external server.</p>
<h2 id="tool">tool</h2>
<p>Kubernetes does not include extensive auditing capabilities. However, the system is built to be extensible, allowing users the freedom to develop their own custom solutions or select existing add-ons that suit their needs. One of the most common solutions is to add an additional audit backend service that can consume the information logged by Kubernetes and perform additional functionality for users, such as extended search parameters, data mapping capabilities, and alerting capabilities. Enterprises already using SIEM platforms can integrate Kubernetes with these existing capabilities.</p>
<p>Open source monitoring tools, such as Cloud Native Computing Foundation&apos;s Prometheus&#xAE;, Grafana Labs&apos; Grafana&#xAE;, and Elasticsearch&apos;s Elastic Stack (ELK)&#xAE; - can be used to monitor events, run threat analysis, manage alerts, and collect resource isolation parameters and historical usage status and network statistics of running containers. When auditing access control and permission configurations, scanning tools can be useful by assisting in identifying risky permission configurations in RBAC. The NSA and CISA encourage organizations using intrusion detection systems (IDS) in existing environments to consider integrating the service into their Kubernetes environments as well. This integration will enable enterprises to monitor and potentially kill containers that show signs of unusual behavior, allowing containers to be restarted from an initially clean image. Many cloud service providers also offer container monitoring services for those who want a more managed and scalable solution. </p>
<footer class="page-footer"><span class="copyright">Copyright &#xA9; 2023 - 2024 | <a href="https://seifrajhi.github.io/" target="_blank"> Saif(eddine) Rajhi </a> all right reserved.</span><span class="footer-modification"> Updated at 
2024-02-22 21:12:24
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="authentication-and-authorization.html" class="navigation navigation-prev " aria-label="Previous page: Authentication and Authorization">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="upgrading-and-application-security-practices.html" class="navigation navigation-next " aria-label="Next page: Upgrading and application security practices">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Log Audit","level":"2.6","depth":1,"next":{"title":"Upgrading and application security practices","level":"2.7","depth":1,"path":"upgrading-and-application-security-practices.md","ref":"upgrading-and-application-security-practices.md","articles":[]},"previous":{"title":"Authentication and Authorization","level":"2.5","depth":1,"path":"authentication-and-authorization.md","ref":"authentication-and-authorization.md","articles":[]},"dir":"ltr"},"config":{"plugins":["github","codesnippet","splitter","page-toc-button","image-captions","editlink","back-to-top-button","-lunr","-search","search-plus","github-buttons@2.1.0","favicon@^0.0.2","tbfed-pagefooter@^0.0.1","theme-default","-highlight","prism","prism-themes","lightbox","sitemap-general","insert-logo","hide-element","adsense"],"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright © 2023 - 2024 | <a href =https://seifrajhi.github.io/> Saif(eddine) Rajhi </a>","modify_label":" Updated at ","modify_format":"YYYY-MM-DD HH:mm:ss"},"prism":{"css":["prism-themes/themes/prism-ghcolors.css"]},"github":{"url":"https://github.com/seifrajhi/kubernetes-hardening-checklist-guidance"},"editlink":{"label":"Edit this page","multilingual":false,"base":"https://github.com/seifrajhi/kubernetes-hardening-checklist-guidance/blob/main/"},"splitter":{},"adsense":{"client":"ca-pub-4029167986768912","slot":"2445941692","format":"auto","element":".page-inner section","position":"bottom"},"codesnippet":{},"sitemap-general":{"prefix":"https://seifrajhi.github.io/kubernetes-hardening-checklist-guidance/"},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"favicon":{"shortcut":"favicon.ico","bookmark":"favicon.ico"},"lightbox":{"jquery":true,"sameUuid":false},"page-toc-button":{},"back-to-top-button":{},"prism-themes":{},"github-buttons":{"repo":"seifrajhi/kubernetes-hardening-checklist-guidance","types":["star"],"size":"small"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"showLevel":true,"styles":{"ebook":"styles/ebook.css","epub":"styles/epub.css","mobi":"styles/mobi.css","pdf":"styles/pdf.css","print":"styles/print.css","website":"styles/website.css"}},"insert-logo":{"style":"background: none; max-height: 100px; min-height: 30px","url":"https://seifrajhi.github.io/images/logo-black-text.jpeg"},"search-plus":{},"image-captions":{"caption":"_CAPTION_","variable_name":"_pictures"}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"_pictures":[{"backlink":"introduction.html#fig2.1.1","level":"2.1","list_caption":"Figure: Figure 1: High-level view of Kubernetes cluster components","alt":"Figure 1: High-level view of Kubernetes cluster components","nro":1,"url":"images/f1.jpg","index":1,"caption_template":"_CAPTION_","label":"Figure 1: High-level view of Kubernetes cluster components","attributes":{},"skip":false,"key":"2.1.1"},{"backlink":"introduction.html#fig2.1.2","level":"2.1","list_caption":"Figure: Figure 2: Kubernetes architecture","alt":"Figure 2: Kubernetes architecture","nro":2,"url":"images/f2.jpg","index":2,"caption_template":"_CAPTION_","label":"Figure 2: Kubernetes architecture","attributes":{},"skip":false,"key":"2.1.2"},{"backlink":"kubernetes-pod-security.html#fig2.3.1","level":"2.3","list_caption":"Figure: Figure 3: Pod component with sidecar proxy as log container","alt":"Figure 3: Pod component with sidecar proxy as log container","nro":3,"url":"images/f3.jpg","index":1,"caption_template":"_CAPTION_","label":"Figure 3: Pod component with sidecar proxy as log container","attributes":{},"skip":false,"key":"2.3.1"},{"backlink":"kubernetes-pod-security.html#fig2.3.2","level":"2.3","list_caption":"Figure: Figure 4: Container build workflow, optimized with webhook and admission controller","alt":"Figure 4: Container build workflow, optimized with webhook and admission controller","nro":4,"url":"images/f4.jpg","index":2,"caption_template":"_CAPTION_","label":"Figure 4: Container build workflow, optimized with webhook and admission controller","attributes":{},"skip":false,"key":"2.3.2"},{"backlink":"logging.html#fig2.6.1","level":"2.6","list_caption":"Figure: Figure 5: Cluster leverages service mesh to combine logs with network security","alt":"Figure 5: Cluster leverages service mesh to combine logs with network security","nro":5,"url":"images/f5.jpg","index":1,"caption_template":"_CAPTION_","label":"Figure 5: Cluster leverages service mesh to combine logs with network security","attributes":{},"skip":false,"key":"2.6.1"}]},"title":"Kubernetes Hardening Guide (Produced by the National Security Agency)","links":{"sidebar":{"Return to home page":"https://seifrajhi.github.io/kubernetes-hardening-checklist-guidance"}},"gitbook":"*","description":""},"file":{"path":"logging.md","mtime":"2024-02-22T21:12:24.955Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-02-22T21:12:53.797Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-editlink/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search-plus/jquery.mark.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search-plus/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lightbox/js/lightbox.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-insert-logo/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-adsense/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

